<div class="alert alert-warning text-danger" id="warning" style="display:none;"></div>

<div class="buttons">
  <div class="pull-right">
    &nbsp;&nbsp;<input type="button" id="btn-globepayalipay-confirm" class="btn btn-primary" value="{{button_confirm}}">
  </div>
</div>

<script type="text/javascript">
  (function($) {

    $('#btn-globepayalipay-confirm').click(function() {
      $('#warning').hide();
      $.ajax({
        type: 'POST',
        url: '{{payment_submit_url}}',
        data: {
          comment: $('textarea[name=comment]').val()
        },
        dataType: 'json',
        beforeSend: function() {
          $('#btn-globepayalipay-confirm').attr('disabled', 'disabled').val('{{button_loading}}');
        },
        success: function(json) {
          if (json['info']) {
            $('#btn-globepayalipay-confirm').removeAttr('disabled').val('{{button_confirm}}');
            $('#warning').show().text(json['info']);
            return;
          }

          if (json['error']) {
            $('#btn-globepayalipay-confirm').removeAttr('disabled').val('{{button_confirm}}');
            $('#warning').show().text(json['error']);
            return;
          }

          if (json['success']) {
            location = json['success'];
          }
        },
        error: function(e) {
          $('#btn-globepayalipay-confirm').removeAttr('disabled').val('{{button_confirm}}');
          console.warn(e.responseText);
          $('#warning').show().text('Server internal error, please try again later.');
        }
      });
    });

    $(function() {
      var $btn_submiter = $('#journal-checkout-confirm-button');
      if ($btn_submiter.length > 0) {
        $btn_submiter.click(function() {
          if ($('input[name=agree]:checked').length > 0) {
            if ($('input[name=payment_method]:checked').val() == 'globepayalipay') {
              $('#warning').hide();
              $.ajax({
                type: 'POST',
                url: '{{payment_submit_url}}',
                data: {
                  comment: $('textarea[name=comment]').val()
                },
                dataType: 'json',
                beforeSend: function() {
                  $btn_submiter.attr('disabled', 'disabled').text('{{button_loading}}');
                },
                success: function(json) {
                  if (json['info']) {
                    $('#btn-globepayalipay-confirm').removeAttr('disabled').val('{{button_confirm}}');
                    $('#warning').show().text(json['info']);
                    return;
                  }

                  if (json['error']) {
                    $('#btn-globepayalipay-confirm').removeAttr('disabled').val('{{button_confirm}}');
                    $('#warning').show().text(json['error']);
                    return;
                  }

                  if (json['success']) {
                    location = json['success'];
                  }
                },
                error: function(e) {
                  $btn_submiter.removeAttr('disabled').text('{{button_confirm}}');
                  console.warn(e.responseText);
                  $('#warning').show().text('Server internal error, please try again later.');
                }
              });
              return false;
            }

          }
        });
      }
    });
  })(jQuery);
</script>
